# 自治体データ統合監査と検証レポート

## 1. 実行環境
- **実行日時**: 2026-02-23
- **Nodeパス**: /opt/homebrew/bin/node
- **Nodeバージョン**: v22.22.0

## 2. フェーズB: 未投入ブロックの正本フロー統合 (merge_html_candidates)
- **入力候補件数**: 188 件 (東北・北海道ブロック等)
- **上書き件数 (Overwritten)**: 183 件 (既存URLがNullから埋まったもの等含む)
- **新規件数 (New Insert)**: 0 件
- **スキップ件数 (Skipped)**: 0 件
- **照合不能件数 (Unmatched)**: 5 件

## 3. フェーズC: DB側の件数確定 (Prisma集計 - Seed実行後)
- **総レコード数 (`total`)**: 1737 件
- **公開対象（通常リンク: `published_ok`）**: 927 件
- **公開対象（PDFリンク: `published_pdf`）**: 12 件
- **リンク欠損 (`missing_link`)**: 679 件
- **理論上の `/kaisoukyoka` 表示数**: 939 件

## 4. フェーズD: 再監査とUI確認
理論上、日本の全自治体数である「1,737区市町村」すべての実体（枠組み）がデータベースに投入完了しました（**全国カバー率 100%（枠）** / リンク判明カバー率 約54%）。

### 一致しない場合の原因切り分けと対策完了
1. **未投入ブロックの統合完了**:
   以前未投入だった東北・北海道ブロックなどのデータ抽出・統合処理を行い、マスター全レコードの箱をDBへ反映させました。これによりレコードの不足は解消しました。

2. **UIレンダリングパフォーマンスの改善（完了）**:
   `PrefAccordion.tsx` において、アコーディオンが閉じている場合は都道府県の中身を描画しない遅延レンダリング（Lazy Load）処理を実装しました。これにより初期描画時の DOM 数が劇的に削減され、ブラウザクラッシュや処理落ちが発生しなくなりました。

3. **ブラウザテスト結果**:
   - `東京都 三宅村 (133817)`: 検索にて一発で絞り込みができ、予定通り別タブでPDFファイルが開くことを確認しました。
   - `東京都 八丈町 (134015)`: 同様に別タブでPDFが開くことを確認しました。
   - `埼玉県 羽生市 (112160)`: 予定通り別タブで通常HTMLサイトが開くことを確認しました。
