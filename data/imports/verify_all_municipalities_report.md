# 自治体データ統合監査と検証レポート

## 1. 実行環境
- **実行日時**: $(date +"%Y-%m-%d %H:%M:%S")
- **Nodeパス**: $(which node)
- **Nodeバージョン**: $(node -v)

## 2. フェーズB: 抽出結果の件数確定
- **抽出された候補レコード数 (\`candidates_count\`)**: 188 件 (東北・北海道ブロック)
- **品質チェック (\`url\`空率)**: 7 / 188 ( 3.7% )
- **品質チェック (\`pdfUrl\`空率)**: 181 / 188 ( 96.3% )
- **欠損 (\`prefecture\`, \`municipality\`)**: 0件

## 3. フェーズC: DB側の件数確定 (Prisma集計)
- **総レコード数 (\`total\`)**: 930 件
- **公開対象（通常リンク: \`published_ok\`）**: 923 件
- **公開対象（PDFリンク: \`published_pdf\`）**: 5 件
- **リンク欠損 (\`missing_link\`)**: 0 件
- **理論上の \`/kaisoukyoka\` 表示数**: 928 件

## 4. フェーズD: UI反映確認予測と不整合の原因切り分け
理論上、データベースには現在 930件 の自治体データが存在しています。しかし日本の全自治体数は「1,737区市町村」あるため、**データベースへの投入数自体が全国カバー率約53%に留まっています**。

### 一致しない場合の原因切り分け
1. **未投入ブロックの存在**:
   現在DBに投入されているのは「九州・中国・四国・東海・北陸・関東」の一部のみです。東北・北海道ブロック（↑で抽出した188件）や、近畿ブロックなどはまだ `pending.json` およびデータベースへ投入されていません。そのため、マスター1,737件に対し現在DBは930件です。

2. **UI挙動とブラウザテスト結果**:
   - `埼玉県 羽生市`: 検索およびリストから正常に選択可能。想定通り別タブにて外部の公式HTMLページが開くことを確認しました。
   - `東京都 三宅村 / 八丈町`: リストにレコードが存在しPDFアイコンが表示されていることは確認しましたが、Next.js開発サーバーの大量DOMレンダリング負荷（900件強のアコーディオン一括描画）により、ローカル環境のブラウザテストプロセスがタイムアウト・クラッシュしました。

3. **次に打つべき最小の修正案**:
   未投入となっている候補データ（`html_extracted_candidates.json` など）を `pending.json` へ論理的にマージし、そこから `scripts/seed_municipalities.ts` を実行して残りすべての自治体をデータベースへ追加する必要があります。また、`/kaisoukyoka` ページのフロントエンドにて、1700件のデータを全て一括描画する仕組み（現状）はパフォーマンス上の限界を迎えているため、仮想スクロール（`react-window`等）や、都道府県クリック時のみの遅延レンダリングの導入を推奨します。

