# Doc-11 Data Governance & Integrity Control Design v1.0

Project: seiren-ohakajimai-navi

## 1. 目的

本ドキュメントは、本プロジェクトにおける
データ統制・整合性維持・変更管理・監査可能性を定義する。

本プロジェクトの中核資産は
1,737自治体データであり、
これを破壊・汚染・揺らぎから守ることを最優先とする。

---

## 2. データ資産分類

### 2.1 マスターデータ

- 自治体情報
- municipalitySlug
- 改葬許可関連情報
- リンク情報

### 2.2 派生データ

- sitemap
- SEOメタ情報
- 構造化データ

### 2.3 監査データ

- 差分履歴
- commit履歴
- 不変条件検証ログ

---

## 3. ガバナンス原則

### 3.1 非破壊原則

- データ削除禁止
- 既存値の直接上書き禁止
- バージョン付与で履歴保持

### 3.2 件数固定原則

- 自治体総数は 1,737
- 件数変更は重大異常

### 3.3 一貫性原則

- slugは唯一
- 同一自治体に複数slug禁止
- JIS変換揺れ排除

### 3.4 監査可能原則

- 変更理由が追跡可能
- 差分が明示的

---

## 4. データ変更フロー

### 4.1 変更前確認

- 対象レコード特定
- 影響範囲特定
- 件数確認

### 4.2 変更実施

- 差分最小
- 不要キー削除
- PDF_ONLY整合確認

### 4.3 変更後検証

- 不変条件チェック
- 件数チェック
- slug重複チェック

---

## 5. 不変条件定義

### 5.1 PDF_ONLYルール

linkStatus=PDF_ONLY の場合：

- url=null
- pdfUrl非null
- linkType=PDF

### 5.2 URL整合

- urlにPDF直リンク禁止
- pdfUrlはPDF専用

### 5.3 slug整合

- 重複禁止
- 空禁止
- 文字種正規化済み

---

## 6. バージョン管理

### 6.1 docs

- 上書き禁止
- v1.1, v1.2 で増分管理

### 6.2 データ変更

- 差分を明確化
- 変更理由をcommit messageに記載

---

## 7. 監査設計

### 7.1 監査観点

- 件数差分
- 不変条件違反
- 重複slug

### 7.2 定期監査

- verify:ci 実行
- slug一覧出力比較
- sitemap件数比較

---

## 8. 異常検知

以下は即修正対象：

- 件数ズレ
- PDF_ONLY違反
- url/pdfUrl混在
- slug重複

---

## 9. 将来拡張方針

- API公開時はデータアクセス監査追加
- 更新操作に承認フロー追加可能設計

---

## 10. リスク管理

| リスク | 対策 |
|--------|------|
| 誤差分適用 | CIゲート |
| slug崩壊 | 手動レビュー |
| PDFリンク誤格納 | 差分最小原則 |

---

## 11. 変更履歴

| Version | 内容 |
|---------|------|
| v1.0 | 初版 |
