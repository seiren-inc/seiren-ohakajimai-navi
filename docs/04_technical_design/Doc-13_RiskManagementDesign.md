# Doc-13 Risk Management & Failure Mode Design v1.0

Project: seiren-ohakajimai-navi

## 1. 目的

本ドキュメントは、本プロジェクトにおける
想定リスク、故障モード、影響範囲、検知方法、復旧手順を定義する。

設計原則は「壊れる前提」。

---

## 2. リスク分類

### 2.1 データ系リスク

- 自治体件数ズレ
- slug重複
- PDF_ONLY違反
- url/pdfUrl混在

### 2.2 アプリケーション系リスク

- Server Componentレンダリング失敗
- 大量DOMフリーズ再発
- メモリリーク

### 2.3 ビルド系リスク

- Nodeバージョン不一致
- ビルド失敗
- lockファイル不整合

### 2.4 SEO系リスク

- 重複URL生成
- sitemap不整合
- canonical誤設定

### 2.5 運用系リスク

- force push
- 大量add
- main直コミット

---

## 3. 故障モード定義

### 3.1 データ破損モード

**症状**

- CI失敗
- 件数減少
- slug不一致

**検知**

- 不変条件チェック
- 件数監視

**復旧**

- 直近commit確認
- 差分巻き戻し

### 3.2 レンダリング停止モード

**症状**

- ページ白画面
- 無限ローディング

**検知**

- E2E失敗
- 手動スモーク

**復旧**

- 直近変更差分限定修正

### 3.3 パフォーマンス劣化モード

**症状**

- build時間急増
- 表示遅延

**検知**

- build時間比較
- 大量DOM確認

**復旧**

- 遅延レンダリング導入
- O(n^2)構造排除

### 3.4 SEO崩壊モード

**症状**

- インデックス減少
- 重複ページ増加

**検知**

- sitemap検証
- title重複検知

**復旧**

- canonical再設定
- 重複削除

---

## 4. 影響度分類

| 影響度 | 対象 |
|--------|------|
| 重大 | 件数変更、データ削除、ビルド不能 |
| 中 | SEOメタ欠落、一部リンク欠損 |
| 軽微 | description微調整 |

---

## 5. リスク対応優先順位

1. データ整合・非破壊原則
2. ビルド安定性
3. パフォーマンス
4. SEO最適化

---

## 6. リスク低減設計

- CIゲート強制
- 不変条件自動検証
- 差分最小原則
- バージョン管理

---

## 7. フェイルセーフ設計

- エラー時は安全表示
- 不完全データでも落ちない
- 内部ログ保存

---

## 8. 定期リスクレビュー

- slug重複チェック
- 件数確認
- sitemap件数比較
- build時間比較

---

## 9. 重大インシデント対応フロー

1. 異常検知
2. 直近commit特定
3. 差分分析
4. ロールバック
5. 再発防止Doc更新

---

## 10. 将来リスク

| リスク | 対応 |
|--------|------|
| データ爆発 | 分割設計 |
| API乱用 | レート制限 |
| 検索エンジン仕様変更 | SEO Doc更新 |

---

## 11. 変更履歴

| Version | 内容 |
|---------|------|
| v1.0 | 初版 |
