# Doc-12 Scalability & Future Architecture Evolution Design v1.0

Project: seiren-ohakajimai-navi

## 1. 目的

本ドキュメントは、本プロジェクトの将来的拡張性・スケーラビリティ・アーキテクチャ進化方針を定義する。

現時点では 1,737自治体データを前提とするが、
将来的なデータ増加・機能追加・API公開に耐えられる設計を固定する。

---

## 2. 現状アーキテクチャ前提

- Server Component 中心
- Node v22 固定
- 非破壊スキーマ進化
- 不変条件強制
- CIゲート存在
- SEO静的生成

---

## 3. スケール対象

### 3.1 データ増加

- 自治体データ増加
- ガイドページ増加
- 手続き情報追加

### 3.2 トラフィック増加

- 検索流入増加
- 同時アクセス増加

### 3.3 機能追加

- API公開
- 管理機能強化
- 外部連携

---

## 4. 水平スケール設計

### 4.1 Stateless原則

- サーバー側は状態を保持しない
- セッション依存設計を避ける

### 4.2 キャッシュ戦略

- 変化頻度の低いデータは再利用
- キャッシュ破壊は明示的

### 4.3 読み取り最適化

- データ参照はO(1)構造を優先
- 事前正規化

---

## 5. 垂直スケール設計

### 5.1 計算負荷制御

- ループのネスト禁止
- 全件走査回数最小化

### 5.2 メモリ負荷制御

- 不要な中間配列生成を避ける
- 必要最小データのみロード

---

## 6. SEOスケール設計

### 6.1 sitemap増加対策

- 分割生成可能設計
- 件数監視継続

### 6.2 メタ生成負荷制御

- サーバー生成固定
- 重複排除

---

## 7. API公開時の拡張方針

### 7.1 認証設計追加

- トークンベース認証
- レート制限

### 7.2 バージョニング

- /api/v1 形式
- 非破壊進化

---

## 8. データモデル拡張原則

- カラム追加のみ許可
- 既存削除禁止
- enum拡張は追加のみ

---

## 9. 将来機能追加指針

- 改葬手続きフロー管理
- 書類生成機能
- 問い合わせ管理

これらは既存設計を壊さずに追加可能であること。

---

## 10. 進化のルール

### 10.1 変更時の必須事項

- 影響範囲明示
- 不変条件維持
- CI成功

### 10.2 設計変更時

- 対象Docバージョン更新
- 差分記録

---

## 11. ボトルネック検出基準

- build時間急増
- データ処理時間急増
- メモリ消費増加
- CI失敗率増加

---

## 12. 将来リスク

| リスク | 対策 |
|--------|------|
| データ爆発的増加 | 分割設計 |
| SEOページ指数増加 | レート制限 |
| API乱用 | キャッシュ制御 |

---

## 13. 変更履歴

| Version | 内容 |
|---------|------|
| v1.0 | 初版 |
