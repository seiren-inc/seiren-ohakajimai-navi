# Doc-08 Operations & Runbook v1.0

Project: seiren-ohakajimai-navi

## 1. 目的

本ドキュメントは、本プロジェクトの運用手順を明確化し、
再現性・監査性・安全性を担保することを目的とする。

対象範囲：

- ローカル開発運用
- Git運用
- CI運用
- データ更新運用
- 障害対応
- リリース判定

---

## 2. 環境固定

### 2.1 ローカル

- パス固定: `/takumashinnyo/workspace/projects/seiren-ohakajimai-navi`
- iCloudは使用しない
- Node v22 固定

### 2.2 Git

- Owner: seiren-inc
- remote: SSH
- force push 禁止
- 大量 git add 禁止
- main 直コミット禁止

---

## 3. ブランチ運用

### 3.1 作業開始

- main を最新化
- 作業ブランチ作成
- ブランチ名は目的を明示

### 3.2 コミット原則

- 差分最小単位
- 設計変更はDocバージョン付与
- ファイル指定addのみ

### 3.3 マージ前チェック

- verify:ci 成功
- 不変条件成功
- ビルド成功

---

## 4. docs 運用

### 4.1 保存構造

```
/docs
  /00_index
  /01_requirements
  /02_basic_design
  /03_detail_design
  /04_technical_design
  /05_test_design
  /06_security
  /07_performance
  /08_operations
  /99_archive
```

### 4.2 上書き禁止

- 修正時は `Doc-XX_Name_v1.1.md` のようにバージョン追加

### 4.3 セッション依存禁止

- 設計は必ずファイル保存する

---

## 5. データ更新運用

### 5.1 前提

- 自治体件数 1,737 固定
- PDF_ONLY 不変条件厳守
- 非破壊スキーマ進化

### 5.2 更新手順

1. 変更対象特定
2. 差分のみ修正
3. 不変条件チェック実行
4. verify:ci 実行
5. 手動スモーク確認

### 5.3 禁止事項

- 件数変更
- 既存データ削除
- DROP文使用

---

## 6. CI運用

### 6.1 verify:ci 内容

- 型チェック
- テスト
- 不変条件
- ビルド

### 6.2 CI失敗時

- 不変条件ログ確認
- 件数確認
- 直近変更ファイル確認

---

## 7. リリース手順

### 7.1 判定基準

- verify:ci 成功
- セキュリティ警告ゼロ
- 主要ページ手動確認

### 7.2 実行順

- main へマージ
- ビルド確認
- sitemap/robots 出力確認

---

## 8. 障害対応

### 8.1 データ破損

- 直近コミット確認
- 差分確認
- バージョン巻き戻し

### 8.2 ビルド失敗

- Nodeバージョン確認
- lockファイル確認
- CIログ確認

### 8.3 パフォーマンス劣化

- build時間比較
- 大量DOM箇所確認
- 直近変更差分確認

---

## 9. 監査手順

### 9.1 変更履歴確認

- git log
- 対象ファイルの差分確認

### 9.2 不変条件監査

- 自治体件数確認
- PDF_ONLYルール確認

---

## 10. 継続改善

- 設計変更は必ずDoc更新
- 数値閾値確定後はPerformance Doc更新
- 重大障害は再発防止項目をDoc反映

---

## 11. 変更履歴

| Version | 内容 |
|---------|------|
| v1.0 | 初版 |
